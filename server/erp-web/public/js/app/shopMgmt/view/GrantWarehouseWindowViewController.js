/*
 * File: app/view/AuthShopWindowViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('ShopMgmt.view.GrantWarehouseWindowViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.grantwarehouseWindow',

    checkedAll: function (field, newValue, oldValue, eOpts) {
        this.lookupReference('form').setDisabled(newValue);
    },

    save:function(button, e, eOpts){
        var _this = this;
        var view = this.getView();
        if(this.lookupReference('isGrantAll').getValue()){
            Ext.Ajax.request({
                url: '/api/general/shop/grantWhs',
                params:{
                    isGrantAllWhs:'Y',
                    shopId:button.shopId
                },
                success:function(response, opts){
                    //Ext.data.StoreManager.getByKey('gridStore').reload();
                    var data = JSON.parse(response.responseText).data;
                    _this.getView().record.set(data);
                    _this.getView().record.commit();
                    view.close();
                },
                failure : function(response, options) {
                    _this._failure(response);
                }
            });
        }else{
            var strs = [];
            this.lookupReference('form').getForm().getFields().each(function(item){
                if(item.getValue()){
                    strs.push(item.warehouseId);
                }
            });

            Ext.Ajax.request({
                url: '/api/general/shop/grantWhs',
                params:{
                    isGrantAllWhs:'N',
                    shopId:button.shopId,
                    whs:strs.join(',')
                },
                success:function(response, opts){
                    //Ext.data.StoreManager.getByKey('gridStore').reload();
                    var data = JSON.parse(response.responseText).data;
                    data.shippingWhsName = data.shippingWhsName||"";
                    data.returnWhsName = data.returnWhsName||"";
                    _this.getView().record.set(data);
                    _this.getView().record.commit();
                    view.close();
                }
            });
        }
    },

    cancel: function (button, e, eOpts) {
        this.getView().close();
    }
});
