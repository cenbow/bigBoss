/*
 * File: app/view/ShopInfoWindowViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('ShopMgmt.view.ShopInfoWindowViewController', {
	extend: 'Ext.app.ViewController',
	alias: 'controller.shopInfoWindow',

	save: function (button, e, eOpts) {
		var _this = this;
		var form = this.lookupReference("form");
		if (!form.isValid()) {
			return;
		}
		var values = form.getForm().getValues();
		var shopId = form.getForm().findField('id');
		if (!shopId.getValue()) {
			form.getForm().submit({
				url: '/api/general/shop/add',
				params: values,
				success: function () {
					Ext.data.StoreManager.getByKey('gridStore').reload();
					_this.getView().close();
				},
				failure: function(form,action){
					Ext.MessageBox.show({
						title : "提示",
						msg : action.result.error.message,
						buttons : Ext.MessageBox.OK,
						icon : Ext.MessageBox.ERROR
					});
				}
			});
		} else {
			shopId.submitValue = true;
			form.getForm().submit({
				url: '/api/general/shop/update',
				params: values,
				success: function (form,action) {
					//Ext.data.StoreManager.getByKey('gridStore').reload();
					_this.getView().record.set(action.result.data);
					_this.getView().record.commit();
					_this.getView().close();
				}
			});
		}
	},

	cancel: function (button, e, eOpts) {
		this.getView().close();
	}
});
