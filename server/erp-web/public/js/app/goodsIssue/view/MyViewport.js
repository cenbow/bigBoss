/*
 * File: app/view/MyViewport.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('GoodsIssue.view.MyViewport', {
	extend: 'Ext.container.Viewport',
	alias: 'widget.myviewport',

	requires: [
		'GoodsIssue.view.MyViewportViewModel',
		'GoodsIssue.view.MyViewportViewController',
		'Common.view.InventorySearchForm',
		'Ext.grid.Panel',
		'Ext.grid.column.Number',
		'Ext.grid.column.Date',
		'Ext.grid.column.Boolean',
		'Ext.view.Table',
		'Ext.toolbar.Paging'
	],

	controller: 'myviewport',
	viewModel: {
		type: 'myviewport',
	},
	layout: 'border',

	items: [
		{
			xtype: 'inventorysearchform',
			inventoryType: 'GOODS_ISSUE',
			bind: {
				store: '{goodsIssueList}'
			}
		},
		{
			xtype: 'gridpanel',
			region: 'center',
			columnLines: false,
			title: '杂项出库',
			reference: 'goodsIssueGridpanel',
			header: false,
			bind: {
				store: '{goodsIssueList}'
			},
			columns: {
				defaults: {
					align: 'center',
					tdCls: 'with-btngroup',
				},
				items: [
					{
						xtype: 'rownumberer',
						text: '序号',
						width: 37
					},
					{
						xtype: 'widgetcolumn',
						text: '操作',
						width: 130,
						tdCls: 'btngroup',
						dataIndex: 'permission',
						widget: {
							xtype: 'buttongroup',
							baseCls: '',
							layout: {
								type: 'column'
							},
							defaultBindProperty: 'permission',
							setPermission: function () {
								var buttonGroup = this,
									btnArray = buttonGroup.items.items,
									record = btnArray[0].ownerCt.getWidgetRecord();

								console.info("==")
								if (Ext.Array.contains(_USER.permissions, 'goodsIssue:edit')) {
									if (record.get('status') !== '草稿') {
										btnArray[1].hide();
									} else {
										btnArray[1].show();
									}
								} else {
									Ext.Array.each(btnArray, function (item, index) {
										item.setDisabled(true);
									});
								}
							},
							defaults: {
								handler: 'onCommandColumnClick'
							},
							items: [{
								xtype: 'button',
								command: 'print',
								iconCls: 'btn-printer',
								text: '打印'
							}, {
								xtype: 'button',
								command: 'update',
								iconCls: 'btn-edit',
								text: '编辑'
							}]
						}
					},
					{
						xtype: 'gridcolumn',
						text: '出库单号',
						dataIndex: 'baseNo',
						width: 160,
					},
					{
						xtype: 'gridcolumn',
						text: '出库类型',
						dataIndex: 'type',
						//name: 'typeName',
						renderer: 'renderType'
					},
					{
						xtype: 'gridcolumn',
						text: '状态',
						dataIndex: 'status'
					},
					{
						xtype: 'gridcolumn',
						text: '仓库名称',
						dataIndex: 'whsName'
					},
					{
						xtype: 'gridcolumn',
						text: '库区名称',
						dataIndex: 'whsAreaName'
					},
					{
						xtype: 'gridcolumn',
						width: 140,
						text: '创建日期',
						dataIndex: 'createDate',
						formatter: 'date("Y/m/d H:i:s")'
					},
					{
						xtype: 'gridcolumn',
						width: 140,
						text: '出库日期',
						dataIndex: 'postDate',
						formatter: 'date("Y/m/d H:i:s")'
					},
					{
						xtype: 'gridcolumn',
						width: 140,
						text: '更新时间',
						dataIndex: 'updateDate',
						formatter: 'date("Y/m/d H:i:s")'
					},
					{
						xtype: 'gridcolumn',
						text: '创建人',
						dataIndex: 'createByName'
					},
					{
						xtype: 'gridcolumn',
						text: '备注',
						dataIndex: 'memo'
					}
				]
			},
			dockedItems: [
				{
					xtype: 'pagingcustomtoolbar',
					dock: 'bottom',
					width: 360,
					displayInfo: true,
					bind: {
						store: '{goodsIssueList}'
					}
				},
				{
					xtype: 'toolbar',
					dock: 'top',
					items: [
						{
							xtype: 'button',
							iconCls: 'btn-add',
							text: '杂项出库',
							listeners: {
								click: 'onAddDialogButtonClick'
							}
						}
					]
				}
			],
			listeners: {
				select: 'onGridItemSelect',
				itemdblclick: 'onTableItemDblClick'
			}
		},
		{
			xtype: 'gridpanel',
			region: 'south',
			height: 150,
			columnLines: false,
			collapseMode: 'mini',
			collapsible: true,
			split: true,
			title: '出库单明细',
			bind: {
				store: '{goodsIssueLines}'
			},
			columns: {
				defaults: {
					align: 'center',
					tdCls: 'with-btngroup',
					sortable: false
				},
				items: [
					{
						xtype: 'rownumberer',
						text: '序号',
						width: 37
					},
					{
						xtype: 'gridcolumn',
						text: '商品编码',
						dataIndex: 'productCode'
					},
					{
						xtype: 'gridcolumn',
						text: '规格编码',
						dataIndex: 'skuCode'
					},
					{
						xtype: 'gridcolumn',
						text: '规格名称',
						dataIndex: 'skuName'
					},
					{
						xtype: 'gridcolumn',
						text: '出库库区',
						dataIndex: 'whsName'
					},
					{
						xtype: 'gridcolumn',
						text: '出库库位',
						dataIndex: 'whsAreaName'
					},
					{
						xtype: 'gridcolumn',
						text: '出库数量',
						dataIndex: 'quantity'
					},
					{
						xtype: 'gridcolumn',
						text: '出库成本',
						dataIndex: 'price'
					},
					{
						xtype: 'gridcolumn',
						text: '成本合计',
						dataIndex: 'lineTotal'
					},
					{
						xtype: 'gridcolumn',
						text: '备注',
						dataIndex: 'memo'
					}
				]
			}
		}
	]

});