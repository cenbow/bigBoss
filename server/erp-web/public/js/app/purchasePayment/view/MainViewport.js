/*
 * File: app/view/PurchaseOrderViewport.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('PurchasePayment.view.MainViewport', {
  extend: 'Ext.container.Viewport',
  alias: 'widget.mainviewport',

  requires: [
    'PurchasePayment.view.MainViewportViewModel',
    'PurchasePayment.view.MainViewportController',
    'Ext.tree.Panel',
    'Ext.tree.View',
    'Ext.button.Button',
    'Ext.grid.Panel',
    'Ext.menu.Menu',
    'Ext.menu.Item',
    'Ext.form.field.ComboBox',
    'Ext.form.trigger.Trigger',
    'Ext.grid.column.RowNumberer',
    'Ext.selection.CheckboxModel',
    'Ext.toolbar.Paging',
    'Ext.grid.column.Check'
  ],

  controller: 'mainviewport',
  viewModel: {
    type: 'mainviewport'
  },
  layout: 'border',

  items: [
    {
      xtype: 'gridpanel',
      region: 'center',
      columnLines: false,
      reference: 'PurchasePaymentGrid',
      bind: {
        store: '{gridStore}'
      },
      /* collapseMode: 'mini',
       split: true,
       collapsible: true,*/
      header: false,
      dockedItems: [
        {
          xtype: 'form',
          dock: 'top',
          height: 40,
          layout: 'column',
          bodyPadding: 8,
          title: '',
          items: [
            {
              xtype: 'combobox',
              name: 'supplierId',
              columnWidth: 0.16,
              margin: '0 0 8 0',
              padding:'0 5',
              fieldLabel: '供应商',
              labelAlign: 'left',
              labelWidth: 70,
              editable: false,
              forceSelection: true,
              queryMode: 'local',
              displayField: 'name',
              valueField: 'id',
              value: '-1',
              bind: {
                store: '{supplierStore}'
              }

            },
            {
              xtype: 'combobox',
              name: 'status',
              columnWidth: 0.16,
              margin: '0 0 8 0',
              padding:'0 5',
              fieldLabel: '状态',
              labelAlign: 'left',
              labelWidth: 70,
              editable: false,
              forceSelection: true,
              displayField: 'name',
              valueField: 'code',
              queryMode: 'local',
              value:'',
              bind: {
                store: '{statusStore}'
              }
            },
            {
              xtype: 'combobox',
              name: 'paymentType',
              columnWidth: 0.16,
              margin: '0 0 8 0',
              padding:'0 5',
              fieldLabel: '结款类型',
              labelAlign: 'left',
              labelWidth: 70,
              editable: false,
              forceSelection: true,
              queryMode: 'local',
              displayField: 'name',
              valueField: 'code',
              value: '',
              bind: {
                store: '{typeStore}'
              }
            },
            {
              xtype: 'datefield',
              itemId: 'postDateFrom',
              name: 'postDateFrom',
              columnWidth: 0.16,
              margin: '0 0 8 0',
              padding:'0 5',
              fieldLabel: '结款日期',
              labelAlign: 'left',
              labelWidth: 70,
              format: "Y/n/j",
              editable: false,
              listeners: {
                select : function(view, fromValue) {
                  var form = view.up('form')
                  var postDateTo = form.getComponent('postDateTo');
                  postDateTo.setMinValue(fromValue);
                  var toValue = postDateTo.getValue();
                  if(toValue < fromValue) {
                    postDateTo.setValue('');
                  }

                }
              }
            },
            {
              xtype: 'datefield',
              itemId: 'postDateTo',
              name: 'postDateTo',
              columnWidth: 0.16,
              margin: '0 0 8 0',
              padding:'0 5',
              fieldLabel: '至',
              labelAlign: 'left',
              labelWidth: 70,
              format: "Y/n/j",
              editable: false,
            },
            {
              xtype: 'button',
              columnWidth: 0.08,
              margin: '0 10 10 10',
              text: '查询',
              iconCls: 'btn-search',
              handler: 'refreshGrid'
            },
            {
              xtype: 'button',
              columnWidth: 0.08,
              margin: '0 10 10 10',
              text: '清空',
              iconCls: 'btn-clear',
              handler: 'onButtonClearClick'
            }
          ]
        },
        {
          xtype: 'toolbar',
          dock: 'top',
          height: 25,
          items: [
            "-",
            {
              xtype: 'button',
              iconCls: 'btn-form-add',
              text: '新增采购结款单',
              handler: 'addPurchasePayment'
            }
          ]
        },
        {
          xtype: 'pagingcustomtoolbar',
          id: 'pickLocationGrid',
          bind: {
            store: '{gridStore}'
          },
          dock: 'bottom',
          displayInfo: true
        }
      ],
      columns: {
        defaults: {
          cls:'titleAlign',
          tdCls: 'with-btngroup'
        },
        items: [
          {
            xtype: 'rownumberer',
            width: 50,
            text: '序号'
          },
          {
            text: '操作',
            xtype: 'widgetcolumn',
            width: 150,
            tdCls: 'btngroup',
            dataIndex:'progress',
            widget: {
              xtype: 'buttongroup',
              baseCls: 'center',
              layout: {
                type: "column"
              },
              defaultBindProperty: 'permission',
              setPermission: function(){
                var buttonGroup = this,
                  btnArray = buttonGroup.items.items,
                  record = btnArray[0].ownerCt.getWidgetRecord();

                if (record.get('status') !== 'DRAFT') {
                  Ext.each(btnArray, function(item) {
                    item.hide();
                  });
                } else {
                  Ext.each(btnArray, function(item) {
                    item.show();
                  });
                }
              },
              defaults: {
                handler: "onCommandColumnClick"
              },
              items: [{
                xtype: "button",
                command: "Update",
                iconCls: "btn-edit",
                text: "编辑",
              }, {
                xtype: "button",
                command: "Cancel",
                iconCls: "btn-delete",
                text: "取消",
              }]
            }
          },
          {
            xtype: 'gridcolumn',
            width: 170,
            dataIndex: 'paymentNo',
            text: '结款单号'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'statusDesc',
            text: '状态'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'purchaseOrderNo',
            width: 170,
            text: '采购订单号'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'supplierName',
            text: '供应商'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'paymentTypeDesc',
            text: '结款类型'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'paymentMethodName',
            text: '结款方式'
          },
          {
            xtype: 'numbercolumn',
            dataIndex: 'totalFee',
            text: '结款合计'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'postDate',
            formatter: 'date("Y/m/d H:i:s")',
            text: '结款日期'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'updateByName',
            text: '更新人'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'memo',
            text: '备注'
          }
        ]
      },
      listeners: {
        itemdblclick: 'onTableItemDblClick',
        selectionchange: 'onSelectionChange',
      },
    },
    {
      xtype: 'gridpanel',
      region: 'south',
      /*collapseMode: 'mini',
       collapsible: true,*/
      split: true,
      border: false,
      minHeight: 150,
      layout: "fit",
      title: '采购结款明细',
      bind: {
        store: '{paymentLineStore}'
      },
      columns: {
        defaults: {
          align: 'center'
        },
        items: [
          {
            xtype: 'rownumberer',
            width: 50,
            text: '序号'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'purchaseOrderNo',
            width: 170,
            text: '采购单号'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'paymentTypeDesc',
            text: '结款类型'
          },
          {
            xtype: 'gridcolumn',
            dataIndex: 'paymentMethodName',
            text: '结款方式'
          },
          {
            xtype: 'numbercolumn',
            dataIndex: 'paymentAmount',
            text: '结款金额'
          },
          {
            xtype: 'numbercolumn',
            dataIndex: 'discountAmount',
            text: '结款折扣'
          },
          {
            xtype: 'numbercolumn',
            dataIndex: 'paidFee',
            text: '本次清算合计'
          },
          /* {
           xtype: 'gridcolumn',
           dataIndex: 'postDate',
           formatter: 'date("Y/m/d H:i:s")',
           text: '结款日期'
           },
           {
           xtype: 'gridcolumn',
           dataIndex: 'updateByName',
           text: '更新人'
           },*/
          {
            xtype: 'gridcolumn',
            dataIndex: 'memo',
            text: '备注'
          }
        ]
      }

    }
  ]

});