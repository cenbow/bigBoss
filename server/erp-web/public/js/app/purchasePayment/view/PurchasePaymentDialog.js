/*
 * File: app/view/StockTransferEditWindow.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('PurchasePayment.view.PurchasePaymentDialog', {
  extend: 'Ext.window.Window',
  alias: 'widget.purchasepaymentdialog',

  requires: [
    'Common.view.UserDefinedWidget',
    'PurchasePayment.view.PurchasePaymentDialogController',
    'PurchasePayment.view.PurchasePaymentDialogViewModel',
    'Ext.tree.Panel',
    'Ext.tree.View',
    'Ext.button.Button',
    'Ext.grid.Panel',
    'Ext.menu.Menu',
    'Ext.menu.Item',
    'Ext.form.field.ComboBox',
    'Ext.form.trigger.Trigger',
    'Ext.grid.column.RowNumberer',
    'Ext.selection.CheckboxModel',
    'Ext.toolbar.Paging',
    'Ext.grid.column.Check'
  ],

  controller: 'purchasepaymentdialog',
  viewModel: {
    type: 'purchasepaymentdialog'
  },
  heiht: 600,
  width: 900,
  bodyStyle: {
    background: '#fff'
  },
  layout: 'fit',
  bodyPadding: 5,
  title: '采购结款',
  modal: true,
  autoScroll: true,
  items: [
    {
      xtype: 'panel',
      border: false,
      header: false,
      height: 400,
      title: 'My Panel',
      layout: 'border',
      bodyStyle: {
        background: '#fff'
      },

      items: [
        {
          id: 'paymentForm',
          xtype: 'form',
          defaults: {
            columnWidth: 0.5,
            margin: 2,
            labelAlign: 'left',
            labelWidth: 100
          },
          layout: 'column',
          header: false,
          title: 'My Form',
          border: false,
          region: 'north',
          items: [
            {
              xtype: 'textfield',
              name: 'id',
              hidden: true,
              bind: {
                value: '{id}'
              }
            },
            {
              xtype: 'combobox',
              name: "supplierId",
              itemId: 'supplier',
              fieldLabel: '供应商<span style="color:red">*</span>',
              editable: false,
              displayField: 'name',
              valueField: 'id',
              queryMode: 'local',
              emptyText: '请选择供应商',
              allowBlank: false,
              blankText: '供应商不能为空',
              bind: {
                store: '{supplierStore}',
                value: '{supplierId}',
                disabled: '{isEdit}'
              },
              listeners: {
                select: 'onSupplierSelect'
              }
            },
            {
              xtype: 'datefield',
              name: 'postDate',
              fieldLabel: '结款日期<span style="color:red">*</span>',
              editable: false,
              format: "Y/n/j",
              allowBlank: false,
              blankText: '结款日期不能空',
              value: new Date(),
              valueToRaw: function(value) {
                var me = this;
                if(!Ext.isDate(value)) {
                  value = new Date(Number(value))
                }
                return me.formatDate(me.parseDate(value));
              },
              bind: {
                value: '{postDate}'
              }
            },
            {
              xtype: 'combobox',
              name: 'paymentType',
              itemId: 'paymentType',
              fieldLabel: '结款类型<span style="color:red">*</span>',
              editable: false,
              displayField: 'name',
              valueField: 'code',
              queryMode: 'local',
              emptyText: "请选择",
              allowBlank: false,
              blankText: '结款类型不能空',
              bind: {
                store: '{typeStore}',
                value: '{paymentType}',
                disabled: '{isEdit}'
              },
              listeners: {
                change: 'onPaymentTypeChange'
              }
            },
            {
              xtype: 'userdefinedwidget',
              name: 'paymentMethodId',
              itemId: 'paymentMethod',
              fieldLabel: '结款方式<span style="color:red">*</span>',
              editable: false,
              displayField: 'name',
              valueField: 'id',
              queryMode: 'local',
              emptyText: "请选择",
              allowBlank: false,
              forceSelection: true,
              blankText: '结款方式不能空',
              innerDialogConfig: {
                columnTitle: '名称',
                dialogTitle: '结款方式',
                dataIndex: 'name',
                refreshToolbarStore: 'paymentMethodStore'
              },
              bind: {
                store: '{paymentMethodStore}',
                value: '{paymentMethodId}'
              },
              listeners: {
                change: 'onPaymentTypeChange'
              }
            },
            {
              xtype: 'textfield',
              name: 'totalFee',
              itemId:'totalFee',
              fieldLabel: '结款合计',
              editable: false,
              readOnly: true,
              bind:{
                value:'{totalFee}'
              }
            },
            {
              xtype: 'textareafield',
              name: 'memo',
              columnWidth: 1,
              fieldLabel: '备注',
              maxLength: 255,
              maxLengthText: '备注不能超过255个字符',
              bind: {
                value: '{memo}'
              }
            }
          ]
        },
        {
          xtype: 'gridpanel',
          header: false,
          padding: 2,
          region: 'center',
          title: 'My Grid Panel',
          /*store: 'TransferDetailJsonStore',*/
          bind: {
            store: '{paymentLineStore}'
          },
          dockedItems: [
            {
              xtype: 'toolbar',
              dock: 'top',
              items: [
                {
                  xtype: 'button',
                  text: '选择要结算的采购订单',
                  iconCls: 'btn-add',
                  listeners: {
                    click: 'onButtonLineAddClick'
                  }
                }
              ]
            }
          ],
          selModel: 'cellmodel',
          plugins: {
            ptype: 'cellediting',
            clicksToEdit: 1,
            listeners: {
              edit: 'editRow',
              validateedit : 'validateEdit'
            }
          },
          columns: {
            defaults: {
              align: 'center',
              tdCls: 'with-btngroup'
            },
            items: [
              {
                text: '序号',
                xtype: 'rownumberer',
                width: 50
              },
              {
                text: '操作',
                xtype: 'widgetcolumn',
                width: 70,
                tdCls: 'btngroup',
                dataIndex: 'progress',
                widget: {
                  xtype: 'buttongroup',
                  baseCls: "",
                  layout: {
                    type: "column"
                  },
                  defaults: {
                    handler: 'onCommandColumnClick'
                  },
                  items: [{
                    xtype: "button",
                    command: "Delete",
                    iconCls: "btn-delete",
                    text: "删除"
                  }]
                }
              },
              {
                xtype: 'gridcolumn',
                dataIndex: 'purchaseOrderNo',
                width:170,
                text: '采购单号'

              },
              {
                xtype: 'numbercolumn',
                dataIndex: 'totalPurchaseFee',
                text: '采购合计'
              },
              {
                xtype: 'numbercolumn',
                dataIndex: 'totalReceiptFee',
                text: '到货合计'
              },
              {
                xtype: 'numbercolumn',
                dataIndex: 'totalPaidFee',
                text: '已清金额'
              },
              {
                xtype: 'gridcolumn',
                dataIndex: 'paymentTypeDesc',
                text: '结款类型'
              },
              {
                xtype: 'numbercolumn',
                dataIndex: 'paymentAmount',
                text: '结款金额<span class="pencil"/>',
                editor: {
                  xtype: 'numberfield',
                  blankText: '必填',
                  allowBlank: false,
                  enforceMaxLength: true,
                  minValue: 0,
                }
              },
              {
                xtype: 'numbercolumn',
                dataIndex: 'discountAmount',
                text: '结款折扣<span class="pencil"/>',
                editor: {
                  xtype: 'numberfield',
                  blankText: '必填',
                  allowBlank: false,
                  enforceMaxLength: true,
                  minValue: 0,
                }
              },
              {
                xtype: 'numbercolumn',
                dataIndex: 'paidFee',
                text: '本次清算合计',
              },
              {
                xtype: 'gridcolumn',
                dataIndex: 'paymentMethodName',
                text: '结算方式'
              },
              {
                xtype: 'gridcolumn',
                dataIndex: 'memo',
                editor: {
                  xtype: 'textfield',
                  maxLength: 255,
                  enforceMaxLength: true
                },
                text: '备注<span class="pencil"/>'
              }

            ]
          }
        }
      ]
    }
  ],
  dockedItems: [
    {
      xtype: 'toolbar',
      dock: 'bottom',
      ui: 'footer',
      items: [
        {
          xtype: 'tbfill'
        },
        {
          itemId: 'saveDraftBtn',
          xtype: 'button',
          iconCls: 'btn-save',
          handler: 'onButtonSaveDraftClick',
          text: '保存至草稿'

        },
        {
          itemId: 'savePostBtn',
          xtype: 'button',
          iconCls: 'btn-save',
          handler: 'onButtonSavePostClick',
          text: '保存并结款'
        },
        {
          itemId: 'cancelBtn',
          xtype: 'button',
          iconCls: 'btn-cancel',
          handler: 'onButtonCancelClick',
          text: '取消本次结款'
        },
        {
          itemId: 'closeBtn',
          xtype: 'button',
          iconCls: 'btn-cancel',
          handler: 'onButtonCloseClick',
          text: '关闭'
        }
      ]
    }
  ]

});