/*
 * File: app/view/UploadwindowViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('PickLocation.view.UploadwindowViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.uploadwindow',
    cancel: function(button, e, eOpts) {
        this.getView().close();
    },
    upload: function(button, e, eOpts) {
    	var viewCtr = this;
        var formPanel = this.getView().down("form");
        var form = formPanel.getForm();
        var path = form.getFieldValues()['file'];
        var ext = path.substring(path.lastIndexOf(".") + 1, path.length).toLowerCase();
        if (ext != "csv")
            Ext.Msg.alert("错误","请选择CSV格式的文件!");
        else {
            form.submit({
                url: '/api/inventory/warehouse/pickloc/importPickLocCsv',
                waitMsg: '正在上传文件... 请耐心等待.',
                method: 'post',
                success : function(form, action) {
                    var flag=action.result.success;
                    if(flag) {
                        Ext.getStore('gridStore').reload();
                        viewCtr.getView().close();
                    } else {
                        TipsUtil.showTips('错误', action.result.error.message,'error');
                    }

                },
                failure : function(form,action) {
                    if(!action.result){
                        TipsUtil.showTips('错误','上传失败','error');
                    }
                    TipsUtil.showTips('错误',action.result.error.message|| '上传失败','error');
                }
            });
        }
    },
});
