/*
 * File: app/view/TemplateInfoWindowViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('PrintTemplate.view.TemplateInfoWindowViewController', {
  extend: 'Ext.app.ViewController',
  alias: 'controller.templateinfowindow',

  save: function () {
    var viewCtr = this,
      view = viewCtr.getView(),
      formPanel = this.lookupReference('form'),
      form = formPanel.getForm(),
      values = formPanel.getValues();
    if (!formPanel.isValid()) {
      TipsUtil.showTips("提示", '信息填写不正确，请检查错误后重新填写', TipsUtil.WARING);
      return;
    }
    if (!viewCtr.getViewModel().data.isEdit && this._checkFormEmpty()) {
      return;
    }
    var url = '/api/general/template/';
    if (values.id) {
      url += 'update';
    } else {
      url += 'add';
    }
    view.el.mask("正在保存，请稍候...");
    form.submit({
      method: 'POST',
      url: url,
      params: {
        'dataForm': Ext.encode(values),
        'companyId': _USER.companyId
      },
      success: function (form, action) {
        var flag = action.result.success;
        viewCtr.getView().el.unmask();
        if (flag) {
          TipsUtil.showTips("提示", action.result.data, TipsUtil.WARING, function () {
            Ext.StoreMgr.get('GridStore').load();
            viewCtr.getView().close();
          });
        } else {
          Ext.Msg.alert('错误', action.result.error.message);
        }
      },
      failure: function (form, action) {
        viewCtr.getView().el.unmask();
        Ext.Msg.alert("错误", action.result.error.message);
      }
    });
  },
  cancel: function () {
    this.getView().close();
  },

  _checkFormEmpty: function () {
    var viewCtr = this,
      formPanel = this.lookupReference('form'),
      values = formPanel.getValues();
    if (values.name == "" || values.name == null) {
      TipsUtil.showTips("提示", "模板名称不能为空", TipsUtil.WARING);
      return true;
    }
    if (values.type == "" || values.type == null) {
      TipsUtil.showTips("提示", "模板类型不能为空", TipsUtil.WARING);
      return true;
    }
    return false;
  }
});
