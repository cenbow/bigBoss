/*
 * File: app/view/BatchUpdateProduteDialogViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('ProductMgmt.view.BatchProductInfoDialogViewController', {
  extend: 'Ext.app.ViewController',
  alias: 'controller.batchproductinfodialog',

  /**
   * 保存
   */
  onSaveButtonClick: function() {
    var viewCtr = this,
        view = viewCtr.getView(),
        referViewModel = viewCtr.getViewModel().get("referController").getViewModel();
        formCmp = view.down('form');

    if (!formCmp.isValid()) {
      TipsUtil.showTips("提示", '请检查数据填写是否完整', TipsUtil.WARING);
      return ;
    }

    view.el.mask("正在保存，请稍候...");

    formCmp.submit({
      clientValidation: true,
      submitEmptyText: false,
      url: '/api/product/updateBulk',
      params: {
        ids: referViewModel.get('mainGridSelectedCache.skuIds').join(',')
      },
      scope: viewCtr,
      success: '_onSuccessOperate',
      failure: '_onFauilureOperate'
    });

  },

  /**
   * 成功操作
   * @private
   */
  _onSuccessOperate: function(form, action) {
    console.info("=_onSuccessOperate==");
    var viewCtr = this,
        viewModel = viewCtr.getViewModel(),
        result = Ext.JSON.decode(action.response.responseText);

    viewCtr.getView().el.unmask();

    if (!result.success) {
      TipsUtil.showTips("提示", result.error.message, TipsUtil.WARING);
      return ;
    }

    TipsUtil.showTips("提示", result.data, TipsUtil.INFO, function() {
      viewModel.get("referController").getViewModel().set('mainGridSelectedCache', {
        spuIds: [],
        skuIds: []
      });
      viewModel.get("referController").onFastQueryButtonClick();
      viewCtr.closeView();
    });
  },


  _onFauilureOperate: function(form, action) {
    var viewCtr = this,
        result = Ext.JSON.decode(action.response.responseText);

    viewCtr.getView().el.unmask();
    TipsUtil.showTips("提示", result.error.message, TipsUtil.WARING);
  },

  /**
   * 取消
   */
  onCancelButtonClick: function() {
    var viewCtr = this;

    viewCtr.closeView();
  }
});
