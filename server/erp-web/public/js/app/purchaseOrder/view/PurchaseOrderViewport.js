/*
 * File: app/view/PurchaseOrderViewport.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('PurchaseOrder.view.PurchaseOrderViewport', {
    extend: 'Ext.container.Viewport',
    alias: 'widget.purchaseorderviewport',

    requires: [
        'PurchaseOrder.view.PurchaseOrderViewportViewModel',
        'PurchaseOrder.view.PurchaseOrderViewportViewController',
        'Ext.grid.Panel',
        'Ext.form.Panel',
        'Ext.form.field.ComboBox',
        'Ext.form.field.Date',
        'Ext.view.Table',
        'Ext.toolbar.Paging',
        'Ext.grid.column.RowNumberer',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.tab.Panel',
        'Ext.tab.Tab',
        'Common.ux.PagingToolbarCustom',
        'Common.overrides.PagingToolbarCustom'
    ],

    controller: 'purchaseorderviewport',
    viewModel: {
        type: 'purchaseorderviewport'
    },
    layout: 'border',

    items: [
        {
            xtype: 'gridpanel',
            region: 'center',
            columnLines: false,
            reference: 'purchaseOrderGrid',
            bind: {
                store: '{PurchaseOrderGridStore}'
            },
            listeners: {
                rowClick: 'onGridpanelRowClick'
            },
            dockedItems: [
                {
                    xtype: 'form',
                    dock: 'top',
                    height: 78,
                    layout: 'column',
                    bodyPadding: 10,
                    default:{
                        labelAlign: 'left',
                        labelWidth: 70,
                    },
                    defaultButton: "searchBtn",
                    title: '',
                    items: [
                        {
                            xtype: 'textfield',
                            name:'purchaseOrderNo',
                            columnWidth: 0.2,
                            margin: '0 10 10 0',
                            fieldLabel: '采购单号',
                        },
                        {
                            xtype: 'combobox',
                            name:'status',
                            columnWidth: 0.2,
                            fieldLabel: '采购状态',
                            editable: false,
                            forceSelection: true,
                            queryMode: 'local',
                            displayField: 'name',
                            valueField: 'id',
                            margin: '0 10 10 0',
                            bind: {
                                store: 'PurchaseOrderStatusStore'
                            }
                        },
                        {
                            xtype: 'combobox',
                            name:'supplierId',
                            columnWidth: 0.2,
                            fieldLabel: '供应商',
                            margin: '0 10 10 0',
                            editable: false,
                            forceSelection: true,
                            displayField: 'name',
                            valueField: 'id',
                            queryMode: 'local',
                            bind: {
                                store: '{SupplierStore}'
                            }
                        },
                        {
                            xtype: 'combobox',
                            name:'whsId',
                            columnWidth: 0.2,
                            margin: '0 10 10 0',
                            fieldLabel: '仓库',
                            editable: false,
                            forceSelection: true,
                            queryMode: 'local',
                            displayField: 'name',
                            valueField: 'id',
                            bind: {
                                store: '{CommonWhsStore}'
                            },
                        },
                        {
                            xtype: 'textfield',
                            name:'memo',
                            columnWidth: 0.19,
                            margin: '0 10 10 0',
                            fieldLabel: '备注',
                        },
                        {
                            xtype: 'datefield',
                            name:'createDateFrom',
                            columnWidth: 0.2,
                            fieldLabel: '创建日期',
                            margin: '0 10 10 0',
                            format: "Y/n/j",
                            editable: false,
                            bind:{
                                value: '{createDateFrom}',
                                maxValue: '{createDateTo}'
                            }
                        },
                        {
                            xtype: 'datefield',
                            name:'createDateTo',
                            columnWidth: 0.2,
                            fieldLabel: '至',
                            margin: '0 10 10 0',
                            format: "Y/n/j",
                            editable: false,
                            bind:{
                                value: '{createDateTo}',
                                minValue: '{createDateFrom}'
                            }
                        },
                        {
                            xtype: 'textfield',
                            name:'skuCodes',
                            columnWidth: 0.25,
                            fieldLabel: '包含商品',
                            margin: '0 10 10 0',
                            emptyText: '规格编码（多个商品以逗号分隔）',
                            name: 'skuCodes',
                            triggers: {
                                mytrigger: {
                                    handler: 'onButtonGoodsChooseClick',
                                    cls: 'x-form-ellipsis-trigger'
                                }
                            }
                        },
                        {
                            reference: 'searchBtn',
                            xtype: 'button',
                            columnWidth: 0.05,
                            margin: '0 10 10 0',
                            text: '查询',
                            iconCls: 'btn-search',
                            listeners:{
                                'click': 'onButtonSearchClick'
                            }
                        },
                        {
                            xtype: 'button',
                            columnWidth: 0.05,
                            margin: '0 10 10 0',
                            text: '清空',
                            iconCls: 'btn-clear',
                            handler: 'onButtonClearClick'
                        }
                    ]
                },
                {
                    xtype: 'toolbar',
                    dock: 'top',
                    height: 25,
                    items: [
                        "-",
                        {
                            xtype: 'button',
                            iconCls: 'btn-form-add',
                            text: '新增采购单',
                            handler: 'addPurchaseOrder',
                            bind: {
                                disabled: '{addButonDisabled}'
                            }
                        }
                    ]
                },
                {
                    xtype: 'pagingcustomtoolbar',
                    id: 'pickLocationGrid',
                    dock: 'bottom',
                    displayInfo: true,
                    bind: {
                        store: '{PurchaseOrderGridStore}'
                    }
                }
            ],
            columns: {
                defaults: {
                    cls: 'titleAlign'
                },
                items:[
                    {
                        xtype: 'rownumberer',
                        width: 50,
                        text: '序号'
                    },
                    {
                        text: '操作',
                        xtype: 'widgetcolumn',
                        width: 200,
                        dataIndex: 'purchaseOrderNo',
                        tdCls: 'btngroup',
                        widget: {
                            xtype: 'buttongroup',
                            baseCls: "",
                            layout: {
                                type: "column"
                            },
                            defaultBindProperty: 'status',
                            hideBtn: function (item,status) {
                                    var command = item.command;
                                    switch (command){
                                        case 'Cancel':
                                            //草稿和待收货 才可取消
                                            if(status == 'DRAFT' ||  status == 'PENDING_RECEIVE'){
                                                item.show();
                                            }else {
                                                item.hide();
                                            }
                                            break;
                                        case 'Completed':
                                            //部分收货 或者  完全收货才能完结
                                            if(status == 'PARTIALLY_RECEIVED' ||  status == 'FULLY_RECEIVED'){
                                                item.show();
                                            }else {
                                                item.hide();
                                            }
                                            break;
                                        case 'Update':
                                            //草稿 和 待收货 才能编辑
                                            if(status == 'DRAFT' ||  status == 'PENDING_RECEIVE'){
                                                item.show();
                                            }else {
                                                item.hide();
                                            }
                                            break;
                                    }

                            },
                            setStatus: function() {
                                var buttonGroup = this,
                                    btnArray = buttonGroup.items.items,
                                    record = btnArray[0].ownerCt.getWidgetRecord(),
                                    status = record.get('status');
                                Ext.Array.each(btnArray, function(item, index) {
                                    if (Ext.Array.contains(_USER.permissions, "purchaseOrder:edit")) {
                                        Ext.Array.each(btnArray, function(item, index) {
                                            buttonGroup.hideBtn(item,status);
                                            item.setDisabled(false);
                                        });
                                    } else {
                                        Ext.Array.each(btnArray, function(item, index) {
                                            buttonGroup.hideBtn(item,status);
                                            item.setDisabled(true);
                                        });
                                    }
                                });
                            },
                            defaults: {
                                handler: "onCommandColumnClick"
                            },
                            items: [{
                                xtype: "button",
                                command: "Cancel",
                                iconCls: "btn-delete",
                                text: "取消",
                                hidden: true
                            },{
                                xtype: "button",
                                command: "Completed",
                                iconCls: "btn-completed",
                                text: "完结",
                                hidden: true
                            },{
                                xtype: "button",
                                command: "Update",
                                iconCls: "btn-edit",
                                text: "编辑",
                                hidden: true
                            }, {
                                xtype: "button",
                                command: "Print",
                                iconCls: "btn-printer",
                                text: "打印"
                            }]
                        }


                    },
                    {
                        xtype: 'gridcolumn',
                        width: 200,
                        dataIndex: 'purchaseOrderNo',
                        text: '采购单号'
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'statusDesc',
                        text: '采购状态'
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'whsName',
                        text: '仓库名称'
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'supplierName',
                        text: '供应商'
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalPurchaseQty',
                        text: '计划采购',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalReceiptQty',
                        text: '采购收货',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalStockQty',
                        text: '实际入库',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'gridcolumn',
                        text: '采购退货',
                        defaults: {
                            cls: 'titleAlign'
                        },
                        columns: [{
                            xtype: 'numbercolumn',
                            text: '要求换货',
                            dataIndex: 'totalReturnExcgQty',
                            align: 'right',
                            format: '000000000'
                        },{
                            xtype: 'numbercolumn',
                            text: '要求退货',
                            dataIndex: 'totalReturnRefundQty',
                            align: 'right',
                            format: '000000000'
                        },{
                            xtype: 'numbercolumn',
                            text: '正常损耗',
                            align: 'right',
                            dataIndex: 'totalLossQty',
                            format: '000000000'
                        }]
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalRemainingQty',
                        text: '剩余到货',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalOverReceiptQty',
                        text: '超收数量',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'receiptRate',
                        align: 'right',
                        text: '到货率'
                    },
                    {
                        xtype: 'datecolumn',
                        dataIndex: 'expectedReceiptDate',
                        text: '预计到货日期',
                        align: 'center',
                        format: "Y/n/j",
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalPurchaseFee',
                        text: '采购合计',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalReceiptFee',
                        text: '到货合计',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'numbercolumn',
                        dataIndex: 'totalPaidFee',
                        text: '已清金额',
                        align: 'right',
                        format: '000000000'
                    },
                    {
                        xtype: 'datecolumn',
                        dataIndex: 'createDate',
                        text: '创建日期',
                        align: 'center',
                        format: "Y/n/j",
                    },
                    {
                        xtype: 'datecolumn',
                        dataIndex: 'updateDate',
                        text: '更新时间',
                        align: 'center',
                        format: "Y/n/j",
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'createByName',
                        text: '创建人'
                    },
                    {
                        xtype: 'gridcolumn',
                        dataIndex: 'memo',
                        text: '备注'
                    }
                ]
            }
        },
        {
            xtype: 'tabpanel',
            region: 'south',
            collapsible: true,
            split: true,
            height: 150,
            header: false,
            activeTab: 0,
            items: [
                {
                    xtype: 'panel',
                    scrollable: 'true',
                    overlapHeader: false,
                    title: '采购商品名细',
                    items: [
                        {
                            xtype: 'gridpanel',
                            overlapHeader: false,
                            title: '',
                            bind: {
                                store: '{PurchaseOrderDetailStore}'
                            },
                            columns: {
                                defaults: {
                                    cls: 'titleAlign'
                                },
                                items: [{
                                        xtype: 'rownumberer',
                                        width: 50,
                                        text: '序号'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'statusDesc',
                                        text: '行状态'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'productCode',
                                        text: '商品编码'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'skuCode',
                                        text: '规格编码'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'skuName',
                                        text: '规格名称'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'purchaseQty',
                                        text: '采购数量',
                                        align: 'right',
                                        format: '000000000'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'purchaseUnit',
                                        text: '采购单位'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'proportion',
                                        text: '比例',
                                        align: 'right',
                                        format: '000000000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'quantity',
                                        text: '采购数合计',
                                        align: 'right',
                                        format: '000000000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'receiptQty',
                                        text: '采购收货',
                                        align: 'right',
                                        format: '000000000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'stockQty',
                                        text: '实际入库',
                                        align: 'right',
                                        format: '000000000'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        text: '采购退货',
                                        defaults: {
                                            cls: 'titleAlign'
                                        },
                                        columns: [{
                                                xtype: 'numbercolumn',
                                                text: '要求换货',
                                                align: 'right',
                                                dataIndex: 'returnExcgQty',
                                                format: '000000000'
                                            }, {
                                                xtype: 'numbercolumn',
                                                text: '要求退货',
                                                align: 'right',
                                                dataIndex: 'returnRefundQty',
                                                format: '000000000'
                                            }, {
                                                xtype: 'numbercolumn',
                                                text: '正常损耗',
                                                align: 'right',
                                                dataIndex: 'lossQty',
                                                format: '000000000'
                                            }]

                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'remainingQty',
                                        text: '剩余到货',
                                        align: 'right',
                                        format: '000000000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'overReceiptQty',
                                        text: '超收数量',
                                        text: '超收数量',
                                        align: 'right',
                                        format: '000000000'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'price',
                                        text: '采购单价',
                                        align: 'right',
                                        format: '000000000.00'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'lineTotal',
                                        text: '采购费用合计',
                                        align: 'right',
                                        format: '000000000.00'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'receiptFee',
                                        text: '到货合计',
                                        align: 'right',
                                        format: '000000000.00'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        dataIndex: 'expectedReceiptDate',
                                        text: '预计到货日期',
                                        align: 'center',
                                        format: 'Y/m/d'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'memo',
                                        text: '备注'
                                    }
                                ]
                            }
                        }
                    ]
                },
                {
                    xtype: 'panel',
                    scrollable: true,
                    title: '付款明细',
                    items: [
                        {
                            xtype: 'gridpanel',
                            scrollable: false,
                            title: '',
                            bind: {
                                store: '{PurchasePaymentStore}'
                            },
                            columns: {
                                defaults: {
                                    cls: 'titleAlign'
                                },
                                items: [
                                    {
                                        xtype: 'rownumberer',
                                        width: 50,
                                        text: '序号'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'paymentTypeDesc',
                                        text: '结款类型'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'paymentMethodName',
                                        text: '结款方式'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'paymentAmount',
                                        text: '结款金额',
                                        align: 'right',
                                        format: '000000000.00'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'discountAmount',
                                        text: '结款折扣',
                                        align: 'right',
                                        format: '000000000.00'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        dataIndex: 'paidFee',
                                        text: '本次清算合计',
                                        align: 'right',
                                        format: '000000000.00'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'createByName',
                                        text: '结款人'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        dataIndex: 'createDate',
                                        text: '结款日期',
                                        align: 'center',
                                        format: "Y/n/j",
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        dataIndex: 'memo',
                                        text: '备注'
                                    }
                                ]
                            }
                        }
                    ]
                }
            ]
        }
    ]

});