/*
 * File: app/view/ExpressWindowViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('ExpressMgmt.view.ExpressWindowViewController', {
  extend: 'Ext.app.ViewController',
  alias: 'controller.expresswindow',
  init: function() {
    var me = this;
    var viewModel = me.getViewModel();
    var printTplStore = viewModel.getStore("printTplStore");
    var eWaybillPrintTplStore = viewModel.getStore("eWaybillPrintTplStore");
    var codPrintTplStore = viewModel.getStore("codPrintTplStore");
    printTplStore.load({params: {type: 'EXPRESS_WAYBILL'}});
    eWaybillPrintTplStore.load({params: {type: 'EXPRESS_E_WAYBILL'}});
    codPrintTplStore.load({params: {type: 'EXPRESS_COD_WAYBILL'}});
  },
  onButtonCancelClick: function (button, e, eOpts) {
    this.getView().close();
  },
  onButtonSaveClick: function (button, e, eOpts) {
    var me = this;
    var windowView = me.getView();
    var windowViewModel = me.getViewModel();

    var formPanel = windowView.down('form');
    var form = formPanel.getForm();
    var record = form.getValues();
    var url = '/api/general/logistics';
    if (record.id) {
      url += '/update/';
    } else {
      url += '/create';
    }
    if (!form.isValid()) {
      /*Ext.MessageBox.alert('错误', '表单中存在错误!');*/
      return false;
    }
    form.submit({
      waitTitle: '提示',//标题
      waitMsg: '正在提交数据请稍后...',//提示信息
      url: url,
      method: 'post',
      success: function (form, action) {
        var flag = action.result.success;
        if (flag) {
          windowViewModel.get('gridStore').reload();
          windowView.close();
        } else {
          Ext.MessageBox.alert('错误', json.result.error.message);
        }

      },
      failure: function (form, action, response, b) {
        var success = action.result.success;
        if (!success) {
          var message = action.result.error.message;
          Ext.MessageBox.alert('错误', message);
        }

      }
    });

  }
});
