/*
 * File: app/view/RecycleWindowViewController.js
 *
 * This file was generated by Sencha Architect version 3.5.1.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('WhsMgmt.view.RecycleWindowViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.recyclewindow',

    init: function(view){
        this.getViewModel().getStore('recyclewhsstore').load();
    },
    onTreepanelCheckChange: function(node, checked, e, eOpts) {
     if(!node.isLeaf()){
         node.expandChildren();
         Ext.each(node.childNodes,function(childNode){
             childNode.set('checked' , node.get('checked'));
         })
     }else{
         if(!node.get('checked')){
             node.parentNode.set('checked' , false);
         }
     }
    },
    cancel: function(button, e, eOpts) {
        this.getView().close();
    },
    recover: function(button, e, eOpts){
        var checkedNodes = Ext.getCmp('recycleTree').getChecked();
        if(checkedNodes.length==0){
            TipsUtil.showTips("提示","请选择要恢复的库区","info");
            return;
        }
        var areaIds =[];
        var whsIds = [];
        Ext.each(checkedNodes,function(node){
            if(node.isLeaf()){
                areaIds.push(node.get("dbId"));
            }else{
                whsIds.push(node.get("dbId"));
            }
        })
        var view = this.getView();
        var data = {"areaIds":JSON.stringify(areaIds),"whsIds":JSON.stringify(whsIds)}
        Ext.Ajax.request({
            url:'/api/inventory/warehouse/area/batch/recover',
            method: 'POST',
            params :data,
            success: function (response, options) {
                view.close();
                Ext.getStore("treeStore").load();
            }
        })

    }
});
